<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Biblioteca Online</title>
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --panel:#111827;       /* gray-900 */
      --muted:#1f2937;       /* gray-800 */
      --soft:#374151;        /* gray-700 */
      --text:#e5e7eb;        /* gray-200 */
      --sub:#9ca3af;         /* gray-400 */
      --brand:#22d3ee;       /* cyan-400 */
      --accent:#34d399;      /* emerald-400 */
      --warn:#f59e0b;        /* amber-500 */
      --danger:#ef4444;      /* red-500 */
      --ok:#10b981;          /* green-500 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, var(--bg), #0b1224 50%, var(--bg));
      color:var(--text); font: 14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    a{color:var(--brand); text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:16px}
    header{
      position:sticky;top:0;z-index:50;backdrop-filter:saturate(180%) blur(10px);
      background:rgba(15,23,42,.8); border-bottom:1px solid #1f2937;
    }
    .nav{display:flex;align-items:center;gap:14px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:34px;height:34px;border-radius:8px;background:radial-gradient(circle at 30% 30%, var(--brand), var(--accent)); box-shadow:0 0 0 2px #0b1224, var(--shadow)}
    .brand b{font-size:18px}
    .search{flex:1;display:flex;gap:8px;max-width:580px;margin:0 16px}
    .search input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid var(--soft);background:#0b1224;color:var(--text)}
    .search button{padding:10px 12px;border-radius:10px;border:1px solid var(--soft);background:var(--muted);color:var(--text);cursor:pointer}
    .actions{display:flex; gap:8px}
    .btn{cursor:pointer;border:1px solid var(--soft);background:var(--muted);color:var(--text);border-radius:10px;padding:10px 12px;display:inline-flex;align-items:center;gap:8px}
    .btn.primary{background:var(--brand); color:#001018; border-color:transparent; font-weight:600}
    .btn.ghost{background:transparent}
    .btn.badge{position:relative}
    .btn .badge-dot{position:absolute; top:-6px; right:-6px; background:var(--danger); color:#fff; font-size:11px; padding:2px 6px; border-radius:999px; border:2px solid #0b1224}

    /* Layout */
    .grid{display:grid; grid-template-columns:260px 1fr; gap:16px; align-items:start}
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .sidebar{order:2}
    }

    .panel{background:linear-gradient(180deg, #0e152d, #0b1224); border:1px solid #1f2937; border-radius:var(--radius); box-shadow: var(--shadow)}
    .panel .head{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid #1f2937}
    .panel .body{padding:16px}

    /* Sidebar */
    .sidebar .section + .section{margin-top:12px}
    .facet{display:flex;flex-direction:column;gap:8px}
    .facet label{display:flex;align-items:center;gap:10px}
    .price-range{display:flex;gap:8px}
    .price-range input{width:100%; padding:8px; border-radius:10px; border:1px solid var(--soft); background:#0b1224; color:var(--text)}

    /* Products */
    .products{display:grid; grid-template-columns:repeat(4, minmax(0,1fr)); gap:16px}
    @media (max-width:1200px){.products{grid-template-columns:repeat(3, minmax(0,1fr))}}
    @media (max-width:900px){.products{grid-template-columns:repeat(2, minmax(0,1fr))}}
    @media (max-width:580px){.products{grid-template-columns:1fr}}

    .card{position:relative; overflow:hidden; border-radius:14px; border:1px solid #1f2937; background:linear-gradient(180deg,#0f1630,#0b1224)}
    .card .thumb{aspect-ratio: 3/4; width:100%; background:#0a1022; display:flex;align-items:center;justify-content:center}
    .card .thumb img{max-width:75%; max-height:75%; filter:drop-shadow(0 10px 14px rgba(0,0,0,.5))}
    .card .info{padding:12px 12px 14px}
    .title{font-weight:600; margin:4px 0 6px}
    .author{color:var(--sub); font-size:12px}
    .rating{display:flex;align-items:center;gap:6px; font-size:12px; color:var(--warn)}
    .price{display:flex;align-items:center;gap:8px; margin:10px 0}
    .price .now{font-weight:700}
    .price .old{color:var(--sub); text-decoration:line-through}
    .card .actions{display:flex; gap:8px}
    .chip{font-size:11px; padding:4px 8px; border:1px solid var(--soft); color:var(--sub); border-radius:999px}
    .wish{position:absolute; top:8px; right:8px; background:rgba(0,0,0,.35); border:1px solid #1f2937; backdrop-filter: blur(6px); border-radius:999px; padding:6px 8px; cursor:pointer}

    /* Cart drawer */
    .drawer{position:fixed; inset:0; display:none}
    .drawer.open{display:block}
    .drawer .backdrop{position:absolute; inset:0; background:rgba(0,0,0,.55)}
    .drawer .panel{position:absolute; right:0; top:0; height:100%; width:420px; max-width:calc(100% - 40px)}
    .cart-items{display:flex; flex-direction:column; gap:12px; max-height:55vh; overflow:auto}
    .cart-row{display:grid; grid-template-columns:60px 1fr auto; gap:10px; align-items:center; border:1px solid #1f2937; border-radius:12px; padding:8px}
    .qty{display:flex; align-items:center; gap:6px}
    .qty button{width:28px; height:28px; border-radius:8px; background:var(--muted); border:1px solid var(--soft); color:var(--text); cursor:pointer}

    /* Auth modal */
    .modal{position:fixed; inset:0; display:none}
    .modal.open{display:block}
    .modal .backdrop{position:absolute; inset:0; background:rgba(0,0,0,.6)}
    .modal .panel{position:relative; max-width:420px; margin:6vh auto;}
    .field{display:flex; flex-direction:column; gap:6px}
    .field input{padding:10px 12px; border-radius:10px; border:1px solid var(--soft); background:#0b1224; color:var(--text)}
    .hint{font-size:12px; color:var(--sub)}

    /* Footer */
    footer{margin-top:24px; padding:18px 0; color:var(--sub); border-top:1px solid #1f2937}

    .pill{padding:6px 10px; background:#0b1224; border:1px solid #1f2937; border-radius:999px; font-size:12px; color:var(--sub)}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <b>BiblioteCom</b>
        <span class="pill" id="userPill" hidden></span>
      </div>
      <form class="search" id="searchForm" onsubmit="e=>e.preventDefault()">
        <input id="q" placeholder="Busque por título, autor, ISBN" autocomplete="off" />
        <button type="button" id="btnSearch">Buscar</button>
      </form>
      <div class="actions">
        <button class="btn" id="btnLogin">Entrar</button>
        <button class="btn badge" id="btnCart">Carrinho <span class="badge-dot" id="cartBadge" hidden>0</span></button>
      </div>
    </div>
  </header>

  <main class="container" style="padding-top:16px">
    <div class="grid">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="panel section">
          <div class="head"><b>Filtros</b><button class="btn ghost" id="clearFilters">Limpar</button></div>
          <div class="body">
            <div class="facet">
              <b>Categoria</b>
              <label><input type="checkbox" name="cat" value="Ficção"/> Ficção</label>
              <label><input type="checkbox" name="cat" value="Fantasia"/> Fantasia</label>
              <label><input type="checkbox" name="cat" value="Tecnologia"/> Tecnologia</label>
              <label><input type="checkbox" name="cat" value="Negócios"/> Negócios</label>
              <label><input type="checkbox" name="cat" value="Didático"/> Didático</label>
            </div>
            <hr style="border-color:#1f2937; margin:14px 0">
            <div class="facet">
              <b>Formato</b>
              <label><input type="checkbox" name="fmt" value="Impresso"/> Impresso</label>
              <label><input type="checkbox" name="fmt" value="eBook"/> eBook</label>
              <label><input type="checkbox" name="fmt" value="Audiobook"/> Audiobook</label>
            </div>
            <hr style="border-color:#1f2937; margin:14px 0">
            <div class="facet">
              <b>Preço</b>
              <div class="price-range">
                <input type="number" id="minPrice" placeholder="Mín" min="0"/>
                <input type="number" id="maxPrice" placeholder="Máx" min="0"/>
              </div>
            </div>
          </div>
        </div>
        <div class="panel section">
          <div class="head"><b>Ofertas do dia</b><span class="hint">Atualiza às 00:00</span></div>
          <div class="body" id="deals"></div>
        </div>
      </aside>

      <!-- Content -->
      <section>
        <div class="panel">
          <div class="head">
            <div>
              <b>Catálogo</b>
              <span class="hint" id="catalogHint">Todos os livros</span>
            </div>
            <div>
              <select id="sort" class="btn">
                <option value="relevance">Relevância</option>
                <option value="priceAsc">Preço: menor para maior</option>
                <option value="priceDesc">Preço: maior para menor</option>
                <option value="rating">Avaliação</option>
              </select>
            </div>
          </div>
          <div class="body">
            <div class="products" id="products"></div>
            <div style="display:flex;justify-content:center;margin-top:16px;gap:8px">
              <button class="btn" id="prevPage">Anterior</button>
              <span class="pill" id="pageInfo">Página 1</span>
              <button class="btn" id="nextPage">Próxima</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <footer class="container">
      <div style="display:flex;gap:18px;flex-wrap:wrap;justify-content:space-between">
        <div>
          <b>Ajuda</b>
          <div><a href="#">Perguntas frequentes</a></div>
          <div><a href="#">Trocas e devoluções</a></div>
          <div><a href="#">Formas de pagamento</a></div>
        </div>
        <div>
          <b>Institucional</b>
          <div><a href="#">Quem somos</a></div>
          <div><a href="#">Política de privacidade</a></div>
          <div><a href="#">Termos de uso</a></div>
        </div>
        <div>
          <b>Minha conta</b>
          <div><a href="#" id="footerLogin">Entrar</a></div>
          <div><a href="#">Meus pedidos</a></div>
          <div><a href="#">Lista de desejos</a></div>
        </div>
      </div>
      <div style="margin-top:12px" class="hint">© <span id="year"></span> Biblioteca Online. Todos os direitos reservados.</div>
    </footer>
  </main>

  <!-- Drawer Carrinho -->
  <div class="drawer" id="cartDrawer" aria-hidden="true">
    <div class="backdrop" data-close="drawer"></div>
    <div class="panel" style="display:flex;flex-direction:column">
      <div class="head">
        <b>Seu carrinho</b>
        <button class="btn" data-close="drawer">Fechar</button>
      </div>
      <div class="body">
        <div class="cart-items" id="cartItems"></div>
        <hr style="border-color:#1f2937; margin:14px 0">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="hint">Subtotal</div>
            <b id="cartSubtotal">R$ 0,00</b>
          </div>
          <button class="btn primary" id="btnCheckout">Finalizar compra</button>
        </div>
        <div class="hint" style="margin-top:8px">Simulação. Nenhuma cobrança será feita.</div>
      </div>
    </div>
  </div>

  <!-- Modal Login/Cadastro -->
  <div class="modal" id="authModal" aria-hidden="true">
    <div class="backdrop" data-close="modal"></div>
    <div class="panel">
      <div class="head"><b>Acessar conta</b><button class="btn" data-close="modal">Fechar</button></div>
      <div class="body">
        <div class="field"><label>Email</label><input id="email" type="email" placeholder="seu@email.com"/></div>
        <div class="field"><label>Senha</label><input id="password" type="password" placeholder="••••••••"/></div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
          <label style="display:flex;gap:8px;align-items:center"><input type="checkbox" id="remember"/> manter conectado</label>
          <a href="#">Esqueci a senha</a>
        </div>
        <div style="display:flex;gap:8px;margin-top:14px">
          <button class="btn primary" id="doLogin">Entrar</button>
          <button class="btn" id="doRegister">Criar conta</button>
        </div>
        <div class="hint" id="authMsg" style="margin-top:8px"></div>
      </div>
    </div>
  </div>

  <script>
    // Utilidades
    const fmtBR = new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'});
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    // Estado
    const state = {
      page: 1,
      pageSize: 8,
      sort: 'relevance',
      query: '',
      filters: { cat: new Set(), fmt: new Set(), price: [null,null] },
      cart: [],
      user: null,
    };

    // Catálogo exemplo (mock)
  const books = [
  // Ficção
  {id:'1', title:'Como Ficar Rico Sem Trabalhar', author:'Belmiro do Pix', price:79.90, old:129.90, rating:4.9, cat:'Ficção', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/141a36/ffffff&text=Rico+Sem+Trabalhar'},
  {id:'2', title:'Manual do Preguiçoso Eficiente', author:'Lázaro Dorminhoco', price:49.90, old:69.90, rating:4.5, cat:'Ficção', fmt:['Impresso','Audiobook'], cover:'https://dummyimage.com/300x400/151c3c/ffffff&text=Pregui%C3%A7oso+Eficiente'},
  
  // Fantasia
  {id:'3', title:'O Dragão que Virou Vegano', author:'S. Alface Verde', price:64.90, old:89.90, rating:4.6, cat:'Fantasia', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/0e1330/ffffff&text=Drag%C3%A3o+Vegano'},
  {id:'4', title:'Feiticeiro em Home Office', author:'Merlino Freelancer', price:59.90, old:89.90, rating:4.8, cat:'Fantasia', fmt:['Impresso','eBook','Audiobook'], cover:'https://dummyimage.com/300x400/111738/ffffff&text=Feiticeiro+Remoto'},
  
  // Tecnologia
  {id:'5', title:'Java para Quem Odeia Café', author:'Wellington Bugado', price:69.90, old:99.90, rating:4.4, cat:'Tecnologia', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/0f1533/ffffff&text=Java+Sem+Caf%C3%A9'},
  {id:'6', title:'Como Enganar o Algoritmo e Ficar Famoso', author:'Influencer Desconhecido', price:74.90, old:109.90, rating:4.7, cat:'Tecnologia', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/0d122c/ffffff&text=Enganar+Algoritmo'},
  {id:'7', title:'Guia Espiritual do Suporte Técnico', author:'São Ctrl+Alt+Del', price:69.90, old:89.90, rating:4.9, cat:'Tecnologia', fmt:['Impresso','Audiobook'], cover:'https://dummyimage.com/300x400/0b1027/ffffff&text=Suporte+T%C3%A9cnico'},
  
  // Negócios
  {id:'8', title:'Como Sobreviver a Reuniões Que Podiam Ser um E-mail', author:'Ana Cansada', price:59.90, old:89.90, rating:4.8, cat:'Negócios', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/0a0f24/ffffff&text=Reuni%C3%B5es+Email'},
  {id:'9', title:'Marketing para Gatos', author:'Miaurício Felino', price:64.90, old:99.90, rating:4.6, cat:'Negócios', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/0a1128/ffffff&text=Marketing+para+Gatos'},
  {id:'10', title:'O Investidor que Esqueceu a Senha', author:'Naldo Cripto', price:99.90, old:139.90, rating:4.6, cat:'Negócios', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/0b152f/ffffff&text=Investidor+Esqueceu+Senha'},
  
  // Didático
  {id:'11', title:'Python para Poetas', author:'Clarice do While', price:84.90, old:109.90, rating:4.8, cat:'Didático', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/0a1022/ffffff&text=Python+Poetas'},
  {id:'12', title:'Cozinhando com Planilhas do Excel', author:'Chef Fórmula.SOMA()', price:59.90, old:79.90, rating:4.5, cat:'Didático', fmt:['Impresso','eBook'], cover:'https://dummyimage.com/300x400/0a0f21/ffffff&text=Cozinhando+Excel'}
];



    // Persistência simples
    const persist = () => {
      localStorage.setItem('cart', JSON.stringify(state.cart));
      if(state.user) localStorage.setItem('user', JSON.stringify(state.user));
    };
    const restore = () => {
      try{ state.cart = JSON.parse(localStorage.getItem('cart')||'[]'); }catch{}
      try{ state.user = JSON.parse(localStorage.getItem('user')||'null'); }catch{}
      updateCartBadge();
      renderUserPill();
    };

    // Render catálogo
    function filtered(){
      let arr = books.filter(b => {
        // busca
        const q = state.query.trim().toLowerCase();
        const hits = !q || (
          b.title.toLowerCase().includes(q) ||
          b.author.toLowerCase().includes(q)
        );
        if(!hits) return false;
        // categoria
        if(state.filters.cat.size && !state.filters.cat.has(b.cat)) return false;
        // formato
        if(state.filters.fmt.size && !b.fmt.some(f => state.filters.fmt.has(f))) return false;
        // preço
        const [min,max] = state.filters.price;
        if(min!=null && b.price < min) return false;
        if(max!=null && b.price > max) return false;
        return true;
      });
      // sort
      const s = state.sort;
      if(s==='priceAsc') arr.sort((a,b)=>a.price-b.price);
      if(s==='priceDesc') arr.sort((a,b)=>b.price-a.price);
      if(s==='rating') arr.sort((a,b)=>b.rating-a.rating);
      return arr;
    }

    function renderProducts(){
      const list = filtered();
      const start = (state.page-1)*state.pageSize;
      const pageItems = list.slice(start, start+state.pageSize);
      $('#products').innerHTML = pageItems.map(card).join('');
      $('#pageInfo').textContent = `Página ${state.page}`;
      $('#catalogHint').textContent = `${list.length} resultado(s)`;
      // bind buttons
      $$('#products .add').forEach(btn=>btn.addEventListener('click',()=>addToCart(btn.dataset.id)));
      $$('#products .wish').forEach(btn=>btn.addEventListener('click',()=>toggleWish(btn.dataset.id, btn)));
    }

    function stars(r){
      const full = Math.round(r);
      return '★'.repeat(full) + '☆'.repeat(5-full);
    }

    function card(b){
      return `
      <article class="card">
        <button class="wish" title="Favoritar" data-id="${b.id}">♡</button>
        <div class="thumb"><img alt="Capa do livro ${b.title}" src="${b.cover}"/></div>
        <div class="info">
          <div class="chip">${b.cat}</div>
          <div class="title">${b.title}</div>
          <div class="author">${b.author}</div>
          <div class="rating"><span>${stars(b.rating)}</span><span class="hint">${b.rating.toFixed(1)}</span></div>
          <div class="price"><span class="now">${fmtBR.format(b.price)}</span> ${b.old?`<span class="old">${fmtBR.format(b.old)}</span>`:''}</div>
          <div class="actions">
            <button class="btn add primary" data-id="${b.id}">Comprar</button>
            <button class="btn add" data-id="${b.id}">Adicionar ao carrinho</button>
          </div>
        </div>
      </article>`;
    }

    // Favoritos simples para efeito visual
    const wishes = new Set();
    function toggleWish(id, el){
      wishes.has(id) ? wishes.delete(id) : wishes.add(id);
      el.textContent = wishes.has(id) ? '❤' : '♡';
    }

    // Carrinho
    function addToCart(id){
      const item = state.cart.find(i=>i.id===id);
      if(item) item.qty++;
      else state.cart.push({id, qty:1});
      persist();
      updateCartBadge();
      openDrawer();
      renderCart();
    }

    function updateCartBadge(){
      const total = state.cart.reduce((s,i)=>s+i.qty,0);
      const badge = $('#cartBadge');
      if(total>0){ badge.hidden=false; badge.textContent=total; } else { badge.hidden=true; }
    }

    function openDrawer(){ $('#cartDrawer').classList.add('open'); }
    function closeDrawer(){ $('#cartDrawer').classList.remove('open'); }

    function renderCart(){
      const rows = state.cart.map(i=>{
        const b = books.find(x=>x.id===i.id);
        const line = b.price * i.qty;
        return `
          <div class="cart-row">
            <img src="${b.cover}" alt="${b.title}" style="width:60px;height:80px;object-fit:cover;border-radius:8px"/>
            <div>
              <div style="font-weight:600">${b.title}</div>
              <div class="hint">${b.author}</div>
              <div class="hint">${b.cat} • ${i.qty} × ${fmtBR.format(b.price)}</div>
            </div>
            <div style="text-align:right">
              <div class="qty">
                <button data-act="dec" data-id="${i.id}">−</button>
                <span>${i.qty}</span>
                <button data-act="inc" data-id="${i.id}">+</button>
              </div>
              <div style="margin-top:6px">${fmtBR.format(line)}</div>
              <button class="btn" style="margin-top:6px" data-act="rm" data-id="${i.id}">Remover</button>
            </div>
          </div>`;
      }).join('');
      $('#cartItems').innerHTML = rows || '<div class="hint">Seu carrinho está vazio.</div>';
      const subtotal = state.cart.reduce((s,i)=> s + books.find(b=>b.id===i.id).price*i.qty, 0);
      $('#cartSubtotal').textContent = fmtBR.format(subtotal);
      // binds
      $$('#cartItems [data-act]').forEach(btn=>btn.addEventListener('click',()=>{
        const id = btn.dataset.id; const act = btn.dataset.act; const it = state.cart.find(i=>i.id===id);
        if(!it) return;
        if(act==='inc') it.qty++;
        if(act==='dec') it.qty = Math.max(1, it.qty-1);
        if(act==='rm') state.cart = state.cart.filter(i=>i.id!==id);
        persist(); renderCart(); updateCartBadge();
      }));
    }

    // Checkout simulado
    $('#btnCheckout').addEventListener('click', ()=>{
      if(!state.user){ openAuth('Faça login para finalizar a compra.'); return; }
      if(state.cart.length===0){ alert('Carrinho vazio.'); return; }
      alert('Pedido confirmado. Obrigado.');
      state.cart = []; persist(); renderCart(); updateCartBadge(); closeDrawer();
    });

    // Busca e filtros
    $('#btnSearch').addEventListener('click', ()=>{ state.query = $('#q').value; state.page=1; renderProducts(); });
    $('#q').addEventListener('keydown', e=>{ if(e.key==='Enter'){ state.query = e.target.value; state.page=1; renderProducts(); }});
    $('#sort').addEventListener('change', e=>{ state.sort = e.target.value; state.page=1; renderProducts(); });
    $('#prevPage').addEventListener('click', ()=>{ if(state.page>1){ state.page--; renderProducts(); }});
    $('#nextPage').addEventListener('click', ()=>{ const total = filtered().length; if(state.page*state.pageSize < total){ state.page++; renderProducts(); }});

    // Facetas
    $$('input[name="cat"]').forEach(cb=>cb.addEventListener('change', ()=>{ toggleSet(state.filters.cat, cb.value, cb.checked); state.page=1; renderProducts(); }));
    $$('input[name="fmt"]').forEach(cb=>cb.addEventListener('change', ()=>{ toggleSet(state.filters.fmt, cb.value, cb.checked); state.page=1; renderProducts(); }));
    $('#minPrice').addEventListener('change', e=>{ state.filters.price[0] = e.target.value ? Number(e.target.value) : null; state.page=1; renderProducts(); });
    $('#maxPrice').addEventListener('change', e=>{ state.filters.price[1] = e.target.value ? Number(e.target.value) : null; state.page=1; renderProducts(); });
    $('#clearFilters').addEventListener('click', ()=>{
      state.filters.cat.clear(); state.filters.fmt.clear(); state.filters.price=[null,null];
      $$('input[name="cat"]').forEach(cb=>cb.checked=false);
      $$('input[name="fmt"]').forEach(cb=>cb.checked=false);
      $('#minPrice').value=''; $('#maxPrice').value=''; state.page=1; renderProducts();
    });
    function toggleSet(set, val, on){ on? set.add(val) : set.delete(val); }

    // Deals do dia (mock simples)
    function renderDeals(){
      const top = [...books].sort((a,b)=> (b.old?b.old-b.price:0) - (a.old?a.old-a.price:0)).slice(0,3);
      $('#deals').innerHTML = top.map(b=>`<div style="display:flex;justify-content:space-between;gap:8px;align-items:center;margin:6px 0">
        <div>
          <div style="font-weight:600">${b.title}</div>
          <div class="hint">${b.author}</div>
        </div>
        <div style="text-align:right">
          <div class="old">${b.old?fmtBR.format(b.old):''}</div>
          <div class="now">${fmtBR.format(b.price)}</div>
        </div>
      </div>`).join('');
    }

    // Auth
    function openAuth(msg=''){
      $('#authMsg').textContent = msg; $('#authModal').classList.add('open');
    }
    function closeAuth(){ $('#authModal').classList.remove('open'); }
    $('#btnLogin').addEventListener('click', ()=>openAuth());
    $('#footerLogin').addEventListener('click', (e)=>{ e.preventDefault(); openAuth(); });
    $$('#authModal [data-close="modal"]').forEach(b=>b.addEventListener('click', closeAuth));

    $('#doLogin').addEventListener('click', ()=>{
      const email = $('#email').value.trim();
      const pwd = $('#password').value.trim();
      if(!email || !pwd){ $('#authMsg').textContent = 'Informe email e senha.'; return; }
      // Simples: qualquer combinação entra. Produção exigiria backend.
      state.user = {email}; renderUserPill(); persist(); closeAuth();
    });
    $('#doRegister').addEventListener('click', ()=>{
      const email = $('#email').value.trim();
      const pwd = $('#password').value.trim();
      if(!email || !pwd){ $('#authMsg').textContent = 'Preencha email e senha para cadastrar.'; return; }
      state.user = {email, new:true}; renderUserPill(); persist(); closeAuth();
      alert('Conta criada. Você está logado.');
    });

    function renderUserPill(){
      const pill = $('#userPill');
      if(state.user){ pill.hidden=false; pill.textContent = state.user.email; $('#btnLogin').textContent='Sair'; $('#btnLogin').onclick = ()=>{ state.user=null; localStorage.removeItem('user'); renderUserPill(); } }
      else { pill.hidden=true; $('#btnLogin').textContent='Entrar'; $('#btnLogin').onclick = ()=>openAuth(); }
    }

    // Drawer binds
    $('#btnCart').addEventListener('click', ()=>{ renderCart(); openDrawer(); });
    $$('#cartDrawer [data-close="drawer"]').forEach(b=>b.addEventListener('click', closeDrawer));

    // Init
    $('#year').textContent = new Date().getFullYear();
    restore(); renderDeals(); renderProducts();
  </script>
</body>
</html>
